package com.ecmp.flow.service;

import com.ecmp.flow.vo.SaveEntityVo;
import com.ecmp.util.JsonUtils;
import com.ecmp.vo.ResponseData;
import org.junit.Test;
import org.springframework.beans.factory.annotation.Autowired;

public class FlowDesignServiceTest extends BaseContextTestCase {

    @Autowired
    private FlowDesignService service;

    @Test
    public void save() {
        String json = "{\"flowTypeId\":\"B2FC0C5F-5E87-11EA-AEE3-0242C0A8460D\",\"orgId\":\"877035BF-A40C-11E7-A8B9-02420B99179E\",\"orgCode\":\"10607\",\"id\":\"31719D16-5EA7-11EA-B07D-0242C0A8460D\",\"versionCode\":-1,\"priority\":5,\"businessModelId\":\"B0E334A1-5E86-11EA-AEE3-0242C0A8460D\",\"subProcess\":false,\"solidifyFlow\":false,\"timing\":48,\"earlyWarningTime\":24,\"process\":{\"name\":\"流程演示模板\",\"id\":\"ak00002\",\"flowDefVersionId\":\"848FC846-46DF-11ED-B17F-0242C0A84619\",\"isExecutable\":true,\"nodes\":{\"StartEvent_1\":{\"type\":\"StartEvent\",\"x\":91,\"y\":23,\"id\":\"StartEvent_1\",\"target\":[{\"targetId\":\"UserTask_215\",\"uel\":\"\"}],\"name\":\"开始\",\"nodeConfig\":{}},\"EndEvent_161\":{\"type\":\"EndEvent\",\"x\":876,\"y\":0,\"id\":\"EndEvent_161\",\"target\":[],\"name\":\"结束\",\"nodeConfig\":{}},\"UserTask_201\":{\"type\":\"UserTask\",\"x\":374,\"y\":58,\"id\":\"UserTask_201\",\"nodeType\":\"Approve\",\"target\":[{\"targetId\":\"ParallelGateway_218\",\"uel\":{\"agree\":true,\"groovyUel\":\"${approveResult == true}\",\"logicUel\":\"\",\"name\":\"同意\"}},{\"targetId\":\"TerminateEndEvent_220\",\"uel\":{\"groovyUel\":\"\",\"isDefault\":true,\"logicUel\":\"\",\"name\":\"不同意\"}}],\"name\":\"审批任务\",\"nodeConfig\":{\"normal\":{\"allowChooseInstancy\":false,\"allowEntrust\":true,\"allowJumpBack\":false,\"allowPreUndo\":true,\"allowReject\":true,\"allowReturn\":false,\"allowTerminate\":true,\"allowTransfer\":true,\"allowUrged\":true,\"chooseDisagreeReason\":false,\"defaultOpinion\":\"\",\"executeDay\":0,\"executeHour\":0,\"executeMinute\":0,\"id\":\"89B880A6-5E86-11EA-AEE3-0242C0A8460D\",\"mustCommit\":\"\",\"mustExecuteCommit\":true,\"name\":\"审批任务\",\"nodeCode\":\"\",\"singleTaskNoChoose\":false,\"workPageName\":\"查看页面suid\"},\"executor\":[{\"userType\":\"StartUser\"}],\"event\":{\"afterAsync\":false,\"afterExcuteService\":\"\",\"afterExcuteServiceId\":\"\",\"beforeAsync\":true,\"beforeExcuteService\":\"\",\"beforeExcuteServiceId\":\"\"},\"notify\":{\"after\":{\"notifyExecutor\":\"\",\"notifyPosition\":{\"condition\":\"ALL\",\"content\":\"\",\"positionData\":[],\"positionIds\":[],\"type\":[]},\"notifySelfDefinition\":{\"condition\":\"ALL\",\"content\":\"\",\"name\":\"\",\"notifySelfDefId\":\"\",\"type\":[]},\"notifyStarter\":{\"condition\":\"ALL\",\"content\":\"\",\"type\":[]}},\"before\":{\"notifyExecutor\":{\"content\":\"\",\"type\":[]},\"notifyPosition\":{\"content\":\"\",\"positionData\":[],\"positionIds\":[],\"type\":[]},\"notifySelfDefinition\":{\"content\":\"\",\"name\":\"\",\"notifySelfDefId\":\"\",\"type\":[]},\"notifyStarter\":{\"content\":\"\",\"type\":[]}}}}},\"UserTask_210\":{\"type\":\"UserTask\",\"x\":744,\"y\":339,\"id\":\"UserTask_210\",\"nodeType\":\"Normal\",\"target\":[{\"targetId\":\"EndEvent_161\",\"uel\":\"\"}],\"name\":\"普通任务1\",\"nodeConfig\":{\"normal\":{\"allowChooseInstancy\":false,\"allowEntrust\":true,\"allowPreUndo\":true,\"allowReject\":true,\"allowReturn\":false,\"allowTerminate\":true,\"allowTransfer\":true,\"allowUrged\":true,\"defaultOpinion\":\"\",\"executeDay\":0,\"executeHour\":0,\"executeMinute\":0,\"id\":\"26E3F265-5541-11EB-82FA-0242C0A84620\",\"mustCommit\":\"\",\"mustExecuteCommit\":true,\"name\":\"普通任务1\",\"nodeCode\":\"\",\"singleTaskNoChoose\":false,\"workPageName\":\"修改页面suid\"},\"executor\":[{\"userType\":\"StartUser\"}],\"event\":{\"afterAsync\":false,\"afterExcuteService\":\"\",\"afterExcuteServiceId\":\"\",\"beforeAsync\":true,\"beforeExcuteService\":\"\",\"beforeExcuteServiceId\":\"\"},\"notify\":{\"after\":{\"notifyExecutor\":\"\",\"notifyPosition\":{\"content\":\"\",\"positionData\":[],\"positionIds\":[],\"type\":[]},\"notifySelfDefinition\":{\"content\":\"\",\"name\":\"\",\"notifySelfDefId\":\"\",\"type\":[]},\"notifyStarter\":{\"content\":\"\",\"type\":[]}},\"before\":{\"notifyExecutor\":{\"content\":\"\",\"type\":[]},\"notifyPosition\":{\"content\":\"\",\"positionData\":[],\"positionIds\":[],\"type\":[]},\"notifySelfDefinition\":{\"content\":\"\",\"name\":\"\",\"notifySelfDefId\":\"\",\"type\":[]},\"notifyStarter\":{\"content\":\"\",\"type\":[]}}}}},\"UserTask_215\":{\"type\":\"UserTask\",\"x\":82,\"y\":206,\"id\":\"UserTask_215\",\"nodeType\":\"Approve\",\"target\":[{\"targetId\":\"ParallelGateway_217\",\"uel\":{\"agree\":true,\"groovyUel\":\"${approveResult == true}\",\"logicUel\":\"\",\"name\":\"同意\"}},{\"targetId\":\"TerminateEndEvent_219\",\"uel\":{\"groovyUel\":\"\",\"isDefault\":true,\"logicUel\":\"\",\"name\":\"不同意\"}}],\"name\":\"审批任务\",\"nodeConfig\":{\"normal\":{\"allowChooseInstancy\":false,\"allowEntrust\":true,\"allowJumpBack\":false,\"allowPreUndo\":true,\"allowReject\":true,\"allowReturn\":false,\"allowTerminate\":true,\"allowTransfer\":true,\"allowUrged\":true,\"chooseDisagreeReason\":false,\"defaultOpinion\":\"\",\"executeDay\":0,\"executeHour\":0,\"executeMinute\":0,\"id\":\"26E3F265-5541-11EB-82FA-0242C0A84620\",\"mustCommit\":\"\",\"mustExecuteCommit\":true,\"name\":\"审批任务\",\"nodeCode\":\"\",\"singleTaskNoChoose\":false,\"workPageName\":\"修改页面suid\"},\"executor\":[{\"userType\":\"StartUser\"}],\"event\":{\"afterAsync\":false,\"afterExcuteService\":\"\",\"afterExcuteServiceId\":\"\",\"beforeAsync\":true,\"beforeExcuteService\":\"\",\"beforeExcuteServiceId\":\"\"},\"notify\":{\"after\":{\"notifyExecutor\":\"\",\"notifyPosition\":{\"content\":\"\",\"positionData\":[],\"positionIds\":[],\"type\":[]},\"notifySelfDefinition\":{\"content\":\"\",\"name\":\"\",\"notifySelfDefId\":\"\",\"type\":[]},\"notifyStarter\":{\"content\":\"\",\"type\":[]}},\"before\":{\"notifyExecutor\":{\"content\":\"\",\"type\":[]},\"notifyPosition\":{\"content\":\"\",\"positionData\":[],\"positionIds\":[],\"type\":[]},\"notifySelfDefinition\":{\"content\":\"\",\"name\":\"\",\"notifySelfDefId\":\"\",\"type\":[]},\"notifyStarter\":{\"content\":\"\",\"type\":[]}}}}},\"UserTask_216\":{\"type\":\"UserTask\",\"x\":391,\"y\":340,\"id\":\"UserTask_216\",\"nodeType\":\"Approve\",\"target\":[{\"targetId\":\"ParallelGateway_218\",\"uel\":{\"agree\":true,\"groovyUel\":\"${approveResult == true}\",\"logicUel\":\"\",\"name\":\"同意\"}},{\"targetId\":\"TerminateEndEvent_220\",\"uel\":{\"name\":\"不同意\",\"isDefault\":true,\"logicUel\":\"\",\"groovyUel\":\"\"}}],\"name\":\"审批任务\",\"nodeConfig\":{\"normal\":{\"allowChooseInstancy\":false,\"allowEntrust\":true,\"allowJumpBack\":false,\"allowPreUndo\":true,\"allowReject\":true,\"allowReturn\":false,\"allowTerminate\":true,\"allowTransfer\":true,\"allowUrged\":true,\"chooseDisagreeReason\":false,\"defaultOpinion\":\"\",\"executeDay\":0,\"executeHour\":0,\"executeMinute\":0,\"id\":\"26E3F265-5541-11EB-82FA-0242C0A84620\",\"mustCommit\":\"\",\"mustExecuteCommit\":true,\"name\":\"审批任务\",\"nodeCode\":\"\",\"singleTaskNoChoose\":false,\"workPageName\":\"修改页面suid\"},\"executor\":[{\"userType\":\"StartUser\"}],\"event\":{\"afterAsync\":false,\"afterExcuteService\":\"\",\"afterExcuteServiceId\":\"\",\"beforeAsync\":true,\"beforeExcuteService\":\"\",\"beforeExcuteServiceId\":\"\"},\"notify\":{\"after\":{\"notifyExecutor\":\"\",\"notifyPosition\":{\"content\":\"\",\"positionData\":[],\"positionIds\":[],\"type\":[]},\"notifySelfDefinition\":{\"content\":\"\",\"name\":\"\",\"notifySelfDefId\":\"\",\"type\":[]},\"notifyStarter\":{\"content\":\"\",\"type\":[]}},\"before\":{\"notifyExecutor\":{\"content\":\"\",\"type\":[]},\"notifyPosition\":{\"content\":\"\",\"positionData\":[],\"positionIds\":[],\"type\":[]},\"notifySelfDefinition\":{\"content\":\"\",\"name\":\"\",\"notifySelfDefId\":\"\",\"type\":[]},\"notifyStarter\":{\"content\":\"\",\"type\":[]}}}}},\"ParallelGateway_217\":{\"type\":\"ParallelGateway\",\"x\":224,\"y\":202,\"id\":\"ParallelGateway_217\",\"target\":[{\"targetId\":\"UserTask_201\",\"uel\":\"\"},{\"targetId\":\"UserTask_216\",\"uel\":\"\"}],\"name\":\"并行网关\",\"nodeConfig\":{},\"busType\":\"ParallelGateway\"},\"ParallelGateway_218\":{\"type\":\"ParallelGateway\",\"x\":563,\"y\":188,\"id\":\"ParallelGateway_218\",\"target\":[{\"targetId\":\"UserTask_210\",\"uel\":\"\"}],\"name\":\"并行网关\",\"nodeConfig\":{},\"busType\":\"ParallelGateway\"},\"TerminateEndEvent_219\":{\"type\":\"TerminateEndEvent\",\"x\":90,\"y\":446,\"id\":\"TerminateEndEvent_219\",\"target\":[],\"name\":\"终止结束\",\"nodeConfig\":{}},\"TerminateEndEvent_220\":{\"type\":\"TerminateEndEvent\",\"x\":435,\"y\":213,\"id\":\"TerminateEndEvent_220\",\"target\":[],\"name\":\"终止结束\",\"nodeConfig\":{}}},\"beforeStartServiceName\":\"\",\"beforeStartServiceId\":\"\",\"beforeStartServiceAync\":false,\"afterStartServiceName\":\"\",\"afterStartServiceId\":\"\",\"afterStartServiceAync\":false,\"beforeEndServiceName\":\"\",\"beforeEndServiceId\":\"\",\"beforeEndServiceAync\":false,\"afterEndServiceName\":\"\",\"afterEndServiceId\":\"\",\"afterEndServiceAync\":false,\"logicUel\":\"\",\"startUEL\":{\"code\":\"\",\"isDefault\":false,\"logicUel\":\"\",\"groovyUel\":\"\"}}}";
        SaveEntityVo vo = new SaveEntityVo();
        vo.setDef(json);
        vo.setDeploy(true);
        try {
            ResponseData res = service.save(vo);
            System.out.println(JsonUtils.toJson(res));
        } catch (Exception e) {
            System.out.println(e.getMessage());
        }
    }


    @Test
    public void getEntity() {
        String id = "31719D16-5EA7-11EA-B07D-0242C0A8460D";
        Integer versionCode = -1;
        String businessModelCode = "com.ecmp.flow.entity.DefaultBusinessModel";
        String businessId = "2F497C37-B587-11EC-8926-0242C0A84609";
        ResponseData res = service.getEntity(id, versionCode, businessModelCode, businessId);
        System.out.println(JsonUtils.toJson(res));
    }


}
