package com.ecmp.flow.service;

import com.ecmp.flow.vo.SaveEntityVo;
import com.ecmp.util.JsonUtils;
import com.ecmp.vo.ResponseData;
import org.junit.Test;
import org.springframework.beans.factory.annotation.Autowired;

public class FlowDesignServiceTest extends BaseContextTestCase {

    @Autowired
    private FlowDesignService service;

    @Test
    public void save(){
        String json="{\"flowTypeId\":\"B2FC0C5F-5E87-11EA-AEE3-0242C0A8460D\",\"orgId\":\"877035BF-A40C-11E7-A8B9-02420B99179E\",\"orgCode\":\"10607\",\"id\":\"31719D16-5EA7-11EA-B07D-0242C0A8460D\",\"versionCode\":-1,\"priority\":0,\"businessModelId\":\"B0E334A1-5E86-11EA-AEE3-0242C0A8460D\",\"subProcess\":false,\"solidifyFlow\":false,\"timing\":48,\"earlyWarningTime\":24,\"process\":{\"name\":\"流程自测\",\"id\":\"ak00002\",\"flowDefVersionId\":\"8C48EF35-3C46-11EC-B0C9-0242C0A84611\",\"isExecutable\":true,\"nodes\":{\"EndEvent_4\":{\"type\":\"EndEvent\",\"x\":861,\"y\":199,\"id\":\"EndEvent_4\",\"target\":[],\"name\":\"结束\",\"nodeConfig\":{}},\"UserTask_77\":{\"type\":\"UserTask\",\"x\":630,\"y\":102,\"id\":\"UserTask_77\",\"nodeType\":\"Normal\",\"target\":[{\"targetId\":\"EndEvent_4\",\"uel\":\"\"}],\"name\":\"普通任务3\",\"nodeConfig\":{\"normal\":{\"allowChooseInstancy\":false,\"allowPreUndo\":true,\"allowReject\":true,\"allowReturn\":true,\"allowTerminate\":true,\"allowTransfer\":true,\"defaultOpinion\":\"\",\"executeDay\":0,\"executeHour\":0,\"executeMinute\":0,\"id\":\"89B880A6-5E86-11EA-AEE3-0242C0A8460D\",\"mustCommit\":true,\"name\":\"普通任务3\",\"nodeCode\":\"\",\"singleTaskNoChoose\":false,\"workPageName\":\"查看页面suid（不跳）\"},\"executor\":[{\"userType\":\"StartUser\"}],\"event\":{\"afterAsync\":false,\"afterExcuteService\":\"\",\"afterExcuteServiceId\":\"\",\"beforeAsync\":true,\"beforeExcuteService\":\"\",\"beforeExcuteServiceId\":\"\"},\"notify\":{\"after\":{\"notifyExecutor\":\"\",\"notifyPosition\":{\"content\":\"\",\"positionData\":[],\"positionIds\":[],\"type\":[]},\"notifySelfDefinition\":{\"content\":\"\",\"name\":\"\",\"notifySelfDefId\":\"\",\"type\":[]},\"notifyStarter\":{\"content\":\"\",\"type\":[]}},\"before\":{\"notifyExecutor\":{\"content\":\"\",\"type\":[]},\"notifyPosition\":{\"content\":\"\",\"positionData\":[],\"positionIds\":[],\"type\":[]},\"notifySelfDefinition\":{\"content\":\"\",\"name\":\"\",\"notifySelfDefId\":\"\",\"type\":[]},\"notifyStarter\":{\"content\":\"\",\"type\":[]}}}}},\"UserTask_88\":{\"type\":\"UserTask\",\"x\":599,\"y\":326,\"id\":\"UserTask_88\",\"nodeType\":\"Approve\",\"target\":[{\"targetId\":\"EndEvent_4\",\"uel\":{\"name\":\"同意\",\"agree\":true,\"groovyUel\":\"${approveResult == true}\",\"logicUel\":\"\"}},{\"targetId\":\"UserTask_101\",\"uel\":{\"name\":\"不同意\",\"isDefault\":true,\"logicUel\":\"\",\"groovyUel\":\"\"}}],\"name\":\"审批任务2\",\"nodeConfig\":{\"normal\":{\"allowChooseInstancy\":false,\"allowEntrust\":true,\"allowJumpBack\":false,\"allowPreUndo\":true,\"allowReject\":true,\"allowReturn\":true,\"allowTerminate\":true,\"allowTransfer\":true,\"chooseDisagreeReason\":false,\"defaultOpinion\":\"\",\"executeDay\":0,\"executeHour\":0,\"executeMinute\":0,\"id\":\"89B880A6-5E86-11EA-AEE3-0242C0A8460D\",\"mustCommit\":true,\"name\":\"审批任务2\",\"nodeCode\":\"\",\"singleTaskNoChoose\":false,\"workPageName\":\"查看页面suid（不跳）\"},\"executor\":[{\"userType\":\"StartUser\"}],\"event\":{\"afterAsync\":false,\"afterExcuteService\":\"\",\"afterExcuteServiceId\":\"\",\"beforeAsync\":true,\"beforeExcuteService\":\"\",\"beforeExcuteServiceId\":\"\"},\"notify\":{\"after\":{\"notifyExecutor\":\"\",\"notifyPosition\":{\"condition\":\"ALL\",\"content\":\"\",\"positionData\":[],\"positionIds\":[],\"type\":[]},\"notifySelfDefinition\":{\"condition\":\"ALL\",\"content\":\"\",\"name\":\"\",\"notifySelfDefId\":\"\",\"type\":[]},\"notifyStarter\":{\"condition\":\"ALL\",\"content\":\"\",\"type\":[]}},\"before\":{\"notifyExecutor\":{\"content\":\"\",\"type\":[]},\"notifyPosition\":{\"content\":\"\",\"positionData\":[],\"positionIds\":[],\"type\":[]},\"notifySelfDefinition\":{\"content\":\"\",\"name\":\"\",\"notifySelfDefId\":\"\",\"type\":[]},\"notifyStarter\":{\"content\":\"\",\"type\":[]}}}}},\"UserTask_99\":{\"type\":\"UserTask\",\"x\":347,\"y\":102,\"id\":\"UserTask_99\",\"nodeType\":\"Normal\",\"target\":[{\"targetId\":\"UserTask_104\",\"uel\":\"\"}],\"name\":\"普通任务1\",\"nodeConfig\":{\"normal\":{\"name\":\"普通任务1\",\"nodeCode\":\"\",\"executeDay\":0,\"executeHour\":0,\"executeMinute\":0,\"workPageName\":\"查看页面suid（不跳）\",\"id\":\"89B880A6-5E86-11EA-AEE3-0242C0A8460D\",\"mustCommit\":true,\"defaultOpinion\":\"\",\"allowTerminate\":true,\"allowPreUndo\":true,\"allowReject\":true,\"allowReturn\":true,\"allowTransfer\":true,\"allowChooseInstancy\":false,\"singleTaskNoChoose\":false},\"executor\":[{\"userType\":\"StartUser\"}],\"event\":{\"beforeExcuteService\":\"\",\"beforeExcuteServiceId\":\"\",\"beforeAsync\":true,\"afterExcuteService\":\"\",\"afterExcuteServiceId\":\"\",\"afterAsync\":false},\"notify\":{\"before\":{\"notifyExecutor\":{\"type\":[],\"content\":\"\"},\"notifyStarter\":{\"type\":[],\"content\":\"\"},\"notifyPosition\":{\"type\":[],\"content\":\"\",\"positionData\":[],\"positionIds\":[]},\"notifySelfDefinition\":{\"name\":\"\",\"notifySelfDefId\":\"\",\"type\":[],\"content\":\"\"}},\"after\":{\"notifyExecutor\":\"\",\"notifyStarter\":{\"type\":[],\"content\":\"\"},\"notifyPosition\":{\"type\":[],\"content\":\"\",\"positionData\":[],\"positionIds\":[]},\"notifySelfDefinition\":{\"name\":\"\",\"notifySelfDefId\":\"\",\"type\":[],\"content\":\"\"}}}}},\"UserTask_101\":{\"type\":\"UserTask\",\"x\":111,\"y\":475,\"id\":\"UserTask_101\",\"nodeType\":\"Normal\",\"target\":[{\"targetId\":\"UserTask_102\",\"uel\":\"\"}],\"name\":\"修改节点\",\"nodeConfig\":{\"normal\":{\"name\":\"修改节点\",\"nodeCode\":\"\",\"executeDay\":0,\"executeHour\":0,\"executeMinute\":0,\"workPageName\":\"查看页面suid（不跳）\",\"id\":\"89B880A6-5E86-11EA-AEE3-0242C0A8460D\",\"mustCommit\":true,\"defaultOpinion\":\"\",\"allowTerminate\":true,\"allowPreUndo\":true,\"allowReject\":true,\"allowReturn\":false,\"allowTransfer\":true,\"allowChooseInstancy\":false,\"singleTaskNoChoose\":false},\"executor\":[{\"userType\":\"StartUser\"}],\"event\":{\"beforeExcuteService\":\"\",\"beforeExcuteServiceId\":\"\",\"beforeAsync\":true,\"afterExcuteService\":\"\",\"afterExcuteServiceId\":\"\",\"afterAsync\":false},\"notify\":{\"before\":{\"notifyExecutor\":{\"type\":[],\"content\":\"\"},\"notifyStarter\":{\"type\":[],\"content\":\"\"},\"notifyPosition\":{\"type\":[],\"content\":\"\",\"positionData\":[],\"positionIds\":[]},\"notifySelfDefinition\":{\"name\":\"\",\"notifySelfDefId\":\"\",\"type\":[],\"content\":\"\"}},\"after\":{\"notifyExecutor\":\"\",\"notifyStarter\":{\"type\":[],\"content\":\"\"},\"notifyPosition\":{\"type\":[],\"content\":\"\",\"positionData\":[],\"positionIds\":[]},\"notifySelfDefinition\":{\"name\":\"\",\"notifySelfDefId\":\"\",\"type\":[],\"content\":\"\"}}}}},\"UserTask_102\":{\"type\":\"UserTask\",\"x\":82,\"y\":189,\"id\":\"UserTask_102\",\"nodeType\":\"Approve\",\"target\":[{\"targetId\":\"UserTask_101\",\"uel\":{\"name\":\"不同意\",\"isDefault\":true,\"logicUel\":\"\",\"groovyUel\":\"\"}},{\"targetId\":\"ParallelGateway_103\",\"uel\":{\"name\":\"同意\",\"agree\":true,\"groovyUel\":\"${approveResult == true}\",\"logicUel\":\"\"}}],\"name\":\"审批任务\",\"nodeConfig\":{\"normal\":{\"name\":\"审批任务\",\"nodeCode\":\"\",\"executeDay\":0,\"executeHour\":0,\"executeMinute\":0,\"workPageName\":\"查看页面suid（不跳）\",\"id\":\"89B880A6-5E86-11EA-AEE3-0242C0A8460D\",\"mustCommit\":true,\"defaultOpinion\":\"\",\"allowTerminate\":true,\"allowPreUndo\":true,\"allowReject\":true,\"allowReturn\":false,\"allowTransfer\":true,\"allowEntrust\":true,\"chooseDisagreeReason\":false,\"allowChooseInstancy\":false,\"singleTaskNoChoose\":false,\"allowJumpBack\":false},\"executor\":[{\"userType\":\"StartUser\"}],\"event\":{\"beforeExcuteService\":\"\",\"beforeExcuteServiceId\":\"\",\"beforeAsync\":true,\"afterExcuteService\":\"\",\"afterExcuteServiceId\":\"\",\"afterAsync\":false},\"notify\":{\"before\":{\"notifyExecutor\":{\"type\":[],\"content\":\"\"},\"notifyStarter\":{\"type\":[],\"content\":\"\"},\"notifyPosition\":{\"type\":[],\"content\":\"\",\"positionData\":[],\"positionIds\":[]},\"notifySelfDefinition\":{\"name\":\"\",\"notifySelfDefId\":\"\",\"type\":[],\"content\":\"\"}},\"after\":{\"notifyExecutor\":\"\",\"notifyStarter\":{\"type\":[],\"content\":\"\"},\"notifyPosition\":{\"type\":[],\"content\":\"\",\"positionData\":[],\"positionIds\":[]},\"notifySelfDefinition\":{\"name\":\"\",\"notifySelfDefId\":\"\",\"type\":[],\"content\":\"\"}}}}},\"ParallelGateway_103\":{\"type\":\"ParallelGateway\",\"x\":246,\"y\":190,\"id\":\"ParallelGateway_103\",\"target\":[{\"targetId\":\"UserTask_99\",\"uel\":\"\"},{\"targetId\":\"UserTask_105\",\"uel\":\"\"}],\"name\":\"并行网关\",\"nodeConfig\":{},\"busType\":\"ParallelGateway\"},\"UserTask_104\":{\"type\":\"UserTask\",\"x\":485,\"y\":102,\"id\":\"UserTask_104\",\"nodeType\":\"Normal\",\"target\":[{\"targetId\":\"UserTask_77\",\"uel\":\"\"}],\"name\":\"普通任务2\",\"nodeConfig\":{\"normal\":{\"name\":\"普通任务2\",\"nodeCode\":\"\",\"executeDay\":0,\"executeHour\":0,\"executeMinute\":0,\"workPageName\":\"查看页面suid（不跳）\",\"id\":\"89B880A6-5E86-11EA-AEE3-0242C0A8460D\",\"mustCommit\":true,\"defaultOpinion\":\"\",\"allowTerminate\":true,\"allowPreUndo\":true,\"allowReject\":true,\"allowReturn\":false,\"allowTransfer\":true,\"allowChooseInstancy\":false,\"singleTaskNoChoose\":false},\"executor\":[{\"userType\":\"StartUser\"}],\"event\":{\"beforeExcuteService\":\"\",\"beforeExcuteServiceId\":\"\",\"beforeAsync\":true,\"afterExcuteService\":\"\",\"afterExcuteServiceId\":\"\",\"afterAsync\":false},\"notify\":{\"before\":{\"notifyExecutor\":{\"type\":[],\"content\":\"\"},\"notifyStarter\":{\"type\":[],\"content\":\"\"},\"notifyPosition\":{\"type\":[],\"content\":\"\",\"positionData\":[],\"positionIds\":[]},\"notifySelfDefinition\":{\"name\":\"\",\"notifySelfDefId\":\"\",\"type\":[],\"content\":\"\"}},\"after\":{\"notifyExecutor\":\"\",\"notifyStarter\":{\"type\":[],\"content\":\"\"},\"notifyPosition\":{\"type\":[],\"content\":\"\",\"positionData\":[],\"positionIds\":[]},\"notifySelfDefinition\":{\"name\":\"\",\"notifySelfDefId\":\"\",\"type\":[],\"content\":\"\"}}}}},\"UserTask_105\":{\"type\":\"UserTask\",\"x\":356,\"y\":288,\"id\":\"UserTask_105\",\"nodeType\":\"Approve\",\"target\":[{\"targetId\":\"UserTask_88\",\"uel\":{\"name\":\"同意\",\"agree\":true,\"groovyUel\":\"${approveResult == true}\",\"logicUel\":\"\"}},{\"targetId\":\"UserTask_101\",\"uel\":{\"name\":\"不同意\",\"isDefault\":true,\"logicUel\":\"\",\"groovyUel\":\"\"}}],\"name\":\"审批任务1\",\"nodeConfig\":{\"normal\":{\"name\":\"审批任务1\",\"nodeCode\":\"\",\"executeDay\":0,\"executeHour\":0,\"executeMinute\":0,\"workPageName\":\"查看页面suid（不跳）\",\"id\":\"89B880A6-5E86-11EA-AEE3-0242C0A8460D\",\"mustCommit\":true,\"defaultOpinion\":\"\",\"allowTerminate\":true,\"allowPreUndo\":true,\"allowReject\":true,\"allowReturn\":false,\"allowTransfer\":true,\"allowEntrust\":true,\"chooseDisagreeReason\":false,\"allowChooseInstancy\":false,\"singleTaskNoChoose\":false,\"allowJumpBack\":false},\"executor\":[{\"userType\":\"StartUser\"}],\"event\":{\"beforeExcuteService\":\"\",\"beforeExcuteServiceId\":\"\",\"beforeAsync\":true,\"afterExcuteService\":\"\",\"afterExcuteServiceId\":\"\",\"afterAsync\":false},\"notify\":{\"before\":{\"notifyExecutor\":{\"type\":[],\"content\":\"\"},\"notifyStarter\":{\"type\":[],\"content\":\"\"},\"notifyPosition\":{\"type\":[],\"content\":\"\",\"positionData\":[],\"positionIds\":[]},\"notifySelfDefinition\":{\"name\":\"\",\"notifySelfDefId\":\"\",\"type\":[],\"content\":\"\"}},\"after\":{\"notifyExecutor\":\"\",\"notifyStarter\":{\"type\":[],\"content\":\"\"},\"notifyPosition\":{\"type\":[],\"content\":\"\",\"positionData\":[],\"positionIds\":[]},\"notifySelfDefinition\":{\"name\":\"\",\"notifySelfDefId\":\"\",\"type\":[],\"content\":\"\"}}}}},\"StartEvent_106\":{\"type\":\"StartEvent\",\"x\":6,\"y\":170,\"id\":\"StartEvent_106\",\"target\":[{\"targetId\":\"UserTask_102\",\"uel\":\"\"}],\"name\":\"开始\",\"nodeConfig\":{}}},\"beforeStartServiceName\":\"\",\"beforeStartServiceId\":\"\",\"beforeStartServiceAync\":false,\"afterStartServiceName\":\"\",\"afterStartServiceId\":\"\",\"afterStartServiceAync\":false,\"beforeEndServiceName\":\"\",\"beforeEndServiceId\":\"\",\"beforeEndServiceAync\":false,\"afterEndServiceName\":\"\",\"afterEndServiceId\":\"\",\"afterEndServiceAync\":false,\"logicUel\":\"\",\"startUEL\":{\"code\":\"\",\"isDefault\":false,\"logicUel\":\"\",\"groovyUel\":\"\"}}}";
        SaveEntityVo vo =new SaveEntityVo();
        vo.setDef(json);
        vo.setDeploy(true);
        try{
            ResponseData res =  service.save(vo);
            System.out.println(JsonUtils.toJson(res));
        }catch (Exception e){
            System.out.println(e.getMessage());
        }
    }



    @Test
    public void getEntity() {
        String id = "98307F87-5150-11EA-BBE4-0242C0A84421";
        Integer versionCode = -1;
        String businessModelCode = "com.ecmp.flow.entity.DefaultBusinessModel";
        String businessId = "2AA0E332-5A03-11EA-A372-0242C0A84421";
        ResponseData res = service.getEntity(id,versionCode,businessModelCode,businessId);
        System.out.println(JsonUtils.toJson(res));
    }


}
